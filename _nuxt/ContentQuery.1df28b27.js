import{P as v,U as P,V as C,W as b,L as S,g as Q,X as j,h as k,l as L,Q as O,S as T}from"./entry.13f4dc9c.js";import{c as A,w as g,e as E,s as N,j as R,a as x}from"./utils.996050f3.js";import{h as m,u as D}from"./preview.10a65edc.js";const B=()=>async i=>{const{content:t}=v().public,r=i.params(),o=t.experimental.stripQueryParameters?g(`/query/${`${m(r)}.${t.integrity}`}/${E(r)}.json`):g(`/query/${m(r)}.${t.integrity}.json`);if(N())return(await S(()=>import("./client-db.457e2c8a.js"),["./client-db.457e2c8a.js","./navigation.5e3c256f.js","./entry.13f4dc9c.js","./entry.ca43f793.css","./utils.996050f3.js","./preview.10a65edc.js","./index.a6ef77ff.js"],import.meta.url).then(a=>a.useContentDatabase())).fetch(i);const n=await $fetch(o,{method:"GET",responseType:"json",params:t.experimental.stripQueryParameters?void 0:{_params:R(r),previewToken:D().getPreviewToken()}});if(typeof n=="string"&&n.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return n};function _(i,...t){const{content:r}=v().public,o=A(B(),{initialParams:typeof i!="string"?i:{},legacy:!0});let n;typeof i=="string"&&(n=P(C(i,...t)));const s=o.params;return o.params=()=>{var l,f,d;const a=s();return n&&(a.where=a.where||[],a.first&&(a.where||[]).length===0?a.where.push({_path:b(n)}):a.where.push({_path:new RegExp(`^${n.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(l=a.sort)!=null&&l.length||(a.sort=[{_file:1,$numeric:!0}]),r.locales.length&&((d=(f=a.where)==null?void 0:f.find(h=>h._locale))!=null&&d._locale||(a.where=a.where||[],a.where.push({_locale:r.defaultLocale}))),a},o}const U=Q({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(i){const{path:t,only:r,without:o,where:n,sort:s,limit:a,skip:l,locale:f,find:d}=j(i),c=k(()=>{var e;return(e=t.value)==null?void 0:e.includes("/_")}),h=!v().public.content.experimental.advanceQuery;L(()=>i,()=>u(),{deep:!0});const p=e=>h?e!=null&&e.surround?e.surround:e!=null&&e._id||Array.isArray(e)?e:e==null?void 0:e.result:e.result,{data:y,refresh:u}=await x(`content-query-${m(i)}`,()=>{let e;return t.value?e=_(t.value):e=_(),r.value&&(e=e.only(r.value)),o.value&&(e=e.without(o.value)),n.value&&(e=e.where(n.value)),s.value&&(e=e.sort(s.value)),a.value&&(e=e.limit(a.value)),l.value&&(e=e.skip(l.value)),f.value&&(e=e.where({_locale:f.value})),d.value==="one"?e.findOne().then(p):d.value==="surround"?t.value?h?e.findSurround(t.value):e.withSurround(t.value).findOne().then(p):(console.warn("[Content] Surround queries requires `path` prop to be set."),console.warn("[Content] Query without `path` will return regular `find()` results."),e.find().then(p)):e.find().then(p)});return{isPartial:c,data:y,refresh:u}},render(i){var w;const t=O(),{data:r,refresh:o,isPartial:n,path:s,only:a,without:l,where:f,sort:d,limit:c,skip:h,locale:p,find:y}=i,u={path:s,only:a,without:l,where:f,sort:d,limit:c,skip:h,locale:p,find:y};if(u.find==="one"){if(!r&&(t!=null&&t["not-found"]))return t["not-found"]({props:u,...this.$attrs});if(t!=null&&t.empty&&(r==null?void 0:r._type)==="markdown"&&!((w=r==null?void 0:r.body)!=null&&w.children.length))return t.empty({props:u,...this.$attrs})}else if((!r||!r.length)&&t!=null&&t["not-found"])return t["not-found"]({props:u,...this.$attrs});return t!=null&&t.default?t.default({data:r,refresh:o,isPartial:n,props:u,...this.$attrs}):(($,q)=>T("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:$,data:q},null,2)))("default",{data:r,props:u,isPartial:n})}}),Y=U;export{Y as default};
